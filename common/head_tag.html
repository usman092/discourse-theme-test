<script type="text/discourse-plugin" version="0.8">
  const urlQueryParams = new URLSearchParams(window.location.href);
  console.log("UMSNA", window.location.href);
  console.log(urlQueryParams.get('openEditor'));
  console.log(urlQueryParams.get('courseTag'));

  if (urlQueryParams.get('openEditor') === 'true') {
      const courseTag = urlQueryParams.get('courseTag');
      const urlParts = window.location.href.split('/');
      const lessonTag = urlParts[urlParts.length-1].split('?')[0];

      console.log(urlParts);
      console.log(lessonTag);

      if (lessonTag && courseTag){
          api.modifyClass("model:composer", {
            open(opts) {
              if (!opts) opts = {};
              const categoryObj = this.site.categories.findBy("name", "Courses");
              const id = categoryObj ? categoryObj.id : 0;
              if (!opts.categoryId) {
                opts.categoryId = id;
              }
              return this._super(...arguments);
            },
          });
          const container = Discourse.__container__;
          const Composer = require("discourse/models/composer").default;
          const controller = container.lookup("controller:navigation/category");
          const composerController = container.lookup("controller:composer");
          composerController.open({
            action: Composer.CREATE_TOPIC,
            draftKey: Composer.DRAFT,
            topicTags: [lessonTag, courseTag]
          });

      }
  }
</script>
